
# Post \#54391120 [Link](https://stackoverflow.com/questions/54391120/)

## How to download the latest build artifacts from Azure DevOps programmatically?

**Vote**: 70 (95/702) **Views**: 67627 (128/702) 

**Internal ID** \#2-6-399

Created at 2019-01-27 17:52:22

Tags: `c#` `.net` `azure` `azure-devops` `azure-artifacts`

----------

#### Metadata:

Area: `Back-end`

Language: `c#` (full parsed tag list: `c#`)

----------

**Notepad**


----------

I have a .NET C# application and I would like to download the latest artifacts generated by the latest build of this public Azure DevOps project:

[https://dev.azure.com/LumiaWoA/Boot%20Shim/_build?definitionId=3](https://dev.azure.com/LumiaWoA/Boot%20Shim/_build?definitionId=3)

How does one interface with Azure DevOps to download the artifacts for such a task? 

I have in mind to use an HttpClient to download the zipped artifacts using some special URL.


----------
        
## GPT4 Attempt \#0

To download the latest artifacts from an Azure DevOps project, you can use the Azure DevOps REST API. Here is a general step-by-step guide on how you can do this:

1. **Get a Personal Access Token (PAT)**: You need to create a PAT from Azure DevOps that has the appropriate permissions. You can follow the instructions [here](https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops&tabs=preview-page) to create a PAT.

2. **Get the latest build ID**: You can use the following API to get the latest build ID:
```
https://dev.azure.com/{organization}/{project}/_apis/build/builds?definitions={definitionId}&$top=1&api-version=6.0
```
Replace `{organization}`, `{project}`, and `{definitionId}` with your actual values. The `$top=1` query parameter will return the latest build.

3. **Get the artifact**: Once you have the latest build ID, you can use it to get the artifact with the following API:
```
https://dev.azure.com/{organization}/{project}/_apis/build/builds/{buildId}/artifacts?api-version=6.0
```
Replace `{organization}`, `{project}`, and `{buildId}` with your actual values.

4. **Download the artifact**: The previous API will return a download URL for the artifact. You can use this URL to download the artifact.

Here is a sample C# code using `HttpClient`:

```csharp
var personalAccessToken = "your_pat_here";
var organization = "your_organization_here";
var project = "your_project_here";
var definitionId = "your_definition_id_here";

using (var client = new HttpClient())
{
    client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
    client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", Convert.ToBase64String(Encoding.ASCII.GetBytes(string.Format("{0}:{1}", "", personalAccessToken))));

    // Get latest build
    var response = await client.GetAsync($"https://dev.azure.com/{organization}/{project}/_apis/build/builds?definitions={definitionId}&$top=1&api-version=6.0");
    response.EnsureSuccessStatusCode();
    var result = await response.Content.ReadAsStringAsync();
    var buildId = JsonConvert.DeserializeObject<dynamic>(result).value[0].id;

    // Get artifact
    response = await client.GetAsync($"https://dev.azure.com/{organization}/{project}/_apis/build/builds/{buildId}/artifacts?api-version=6.0");
    response.EnsureSuccessStatusCode();
    result = await response.Content.ReadAsStringAsync();
    var downloadUrl = JsonConvert.DeserializeObject<dynamic>(result).value[0].resource.downloadUrl;

    // Download artifact
    response = await client.GetAsync(downloadUrl);
    response.EnsureSuccessStatusCode();
    var bytes = await response.Content.ReadAsByteArrayAsync();
    File.WriteAllBytes("artifact.zip", bytes);
}
```

This code uses the `Newtonsoft.Json` package for JSON deserialization, so make sure to install it via NuGet.

Please note that this code is a simple example and does not include error handling or other best practices for production-level code.

--------

## GPT4 Attempt \#1

To download the latest artifacts from an Azure DevOps project, you can use the Azure DevOps REST API. Here is a general outline of the steps you need to follow:

1. Get the latest build id.
2. Use the build id to get the list of artifacts for that build.
3. Download the desired artifact.

Here is a sample C# code snippet using HttpClient:

```csharp
using System;
using System.Net.Http;
using System.Threading.Tasks;

class Program
{
    static readonly HttpClient client = new HttpClient();

    static async Task Main()
    {
        string organization = "LumiaWoA";
        string project = "Boot Shim";
        string buildDefinitionId = "3";
        string personalAccessToken = "your_personal_access_token_here";

        client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", personalAccessToken);

        // Get the latest build id
        HttpResponseMessage response = await client.GetAsync($"https://dev.azure.com/{organization}/{project}/_apis/build/builds?definitions={buildDefinitionId}&$top=1&api-version=6.0");
        response.EnsureSuccessStatusCode();
        string responseBody = await response.Content.ReadAsStringAsync();
        dynamic result = JsonConvert.DeserializeObject(responseBody);
        string buildId = result.value[0].id;

        // Get the list of artifacts for that build
        response = await client.GetAsync($"https://dev.azure.com/{organization}/{project}/_apis/build/builds/{buildId}/artifacts?api-version=6.0");
        response.EnsureSuccessStatusCode();
        responseBody = await response.Content.ReadAsStringAsync();
        result = JsonConvert.DeserializeObject(responseBody);
        string downloadUrl = result.value[0].resource.downloadUrl;

        // Download the desired artifact
        response = await client.GetAsync(downloadUrl);
        response.EnsureSuccessStatusCode();
        byte[] artifactData = await response.Content.ReadAsByteArrayAsync();
        // Save the artifact data to a file, etc.
    }
}
```

Please replace `"your_personal_access_token_here"` with your actual personal access token. You can generate a personal access token in Azure DevOps.

This code assumes that the latest build has at least one artifact and that you want to download the first artifact. If this is not the case, you will need to modify the code accordingly.

Also, please note that this code uses the Newtonsoft.Json library to parse the JSON responses from the Azure DevOps REST API. You can install this library via NuGet.

This is a basic example and does not include any error handling. In a production environment, you should add appropriate error handling code.

--------

## GPT4 Attempt \#2

You can use the Azure DevOps REST API to download the latest build artifacts. Here's a general step-by-step guide:

1. **Get the latest build ID**: You need to use the `Builds - List` API to get the ID of the latest build. The API endpoint is: `https://dev.azure.com/{organization}/{project}/_apis/build/builds?definitions={definitionId}&$top=1&api-version=6.0`. Replace `{organization}`, `{project}`, and `{definitionId}` with your actual values.

2. **Get the artifact download URL**: Once you have the latest build ID, you can use the `Build Artifacts - Get` API to get the download URL of the artifact. The API endpoint is: `https://dev.azure.com/{organization}/{project}/_apis/build/builds/{buildId}/artifacts?artifactName={artifactName}&api-version=6.0`. Replace `{organization}`, `{project}`, `{buildId}`, and `{artifactName}` with your actual values.

3. **Download the artifact**: Now that you have the download URL, you can use `HttpClient` to download the artifact.

Here's a sample code snippet in C#:

```csharp
using System.Net.Http;
using System.Threading.Tasks;

public async Task DownloadArtifactAsync()
{
    string organization = "LumiaWoA";
    string project = "Boot Shim";
    string definitionId = "3";
    string artifactName = "drop"; // replace with your actual artifact name

    using (var client = new HttpClient())
    {
        // Get the latest build ID
        var buildListResponse = await client.GetStringAsync($"https://dev.azure.com/{organization}/{project}/_apis/build/builds?definitions={definitionId}&$top=1&api-version=6.0");
        var buildList = JsonConvert.DeserializeObject<BuildList>(buildListResponse);
        var latestBuildId = buildList.Value[0].Id;

        // Get the artifact download URL
        var artifactResponse = await client.GetStringAsync($"https://dev.azure.com/{organization}/{project}/_apis/build/builds/{latestBuildId}/artifacts?artifactName={artifactName}&api-version=6.0");
        var artifact = JsonConvert.DeserializeObject<Artifact>(artifactResponse);
        var downloadUrl = artifact.Resource.DownloadUrl;

        // Download the artifact
        var artifactBytes = await client.GetByteArrayAsync(downloadUrl);
        System.IO.File.WriteAllBytes("artifact.zip", artifactBytes);
    }
}
```

This code assumes that you have classes `BuildList` and `Artifact` that match the JSON responses of the Azure DevOps REST API. You can use a tool like [json2csharp](https://json2csharp.com/) to generate these classes.

Please note that this code does not handle errors and does not include any authentication. If your project is private, you will need to authenticate your requests. You can do this by adding a Personal Access Token (PAT) to your requests:

```csharp
client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", yourPat);
```

Replace `yourPat` with your actual PAT.

--------
