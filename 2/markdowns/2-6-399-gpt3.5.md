
# Post \#54391120 [Link](https://stackoverflow.com/questions/54391120/)

## How to download the latest build artifacts from Azure DevOps programmatically?

**Vote**: 70 (95/702) **Views**: 67627 (128/702) 

**Internal ID** \#2-6-399

Created at 2019-01-27 17:52:22

Tags: `c#` `.net` `azure` `azure-devops` `azure-artifacts`

----------

#### Metadata:

Area: `Back-end`

Language: `c#` (full parsed tag list: `c#`)

----------

**Notepad**


----------

I have a .NET C# application and I would like to download the latest artifacts generated by the latest build of this public Azure DevOps project:

[https://dev.azure.com/LumiaWoA/Boot%20Shim/_build?definitionId=3](https://dev.azure.com/LumiaWoA/Boot%20Shim/_build?definitionId=3)

How does one interface with Azure DevOps to download the artifacts for such a task? 

I have in mind to use an HttpClient to download the zipped artifacts using some special URL.


----------
        
## GPT3.5 Attempt \#0

To download the artifacts generated by the latest build of a public Azure DevOps project, you can use the Azure DevOps REST API. Here are the steps you can follow:

1. Get the latest build ID of the project by making a GET request to the following URL:

   ```
   https://dev.azure.com/{organization}/{project}/_apis/build/latest/{definitionId}?api-version=6.0
   ```

   Replace `{organization}` with the name of your organization, `{project}` with the name of your project, and `{definitionId}` with the ID of the build definition. In your case, the URL would be:

   ```
   https://dev.azure.com/LumiaWoA/Boot%20Shim/_apis/build/latest/3?api-version=6.0
   ```

   This will return a JSON response containing information about the latest build, including its ID.

2. Get the download URL for the artifacts of the latest build by making a GET request to the following URL:

   ```
   https://dev.azure.com/{organization}/{project}/_apis/build/builds/{buildId}/artifacts?api-version=6.0
   ```

   Replace `{organization}` with the name of your organization, `{project}` with the name of your project, and `{buildId}` with the ID of the latest build you obtained in step 1. In your case, the URL would be:

   ```
   https://dev.azure.com/LumiaWoA/Boot%20Shim/_apis/build/builds/123456/artifacts?api-version=6.0
   ```

   This will return a JSON response containing information about the artifacts of the latest build, including their download URLs.

3. Download the artifacts by making a GET request to the download URL of the artifact you want to download. The download URL is contained in the `resource.downloadUrl` property of the JSON response you obtained in step 2.

   You can use an `HttpClient` to make the GET request and download the artifact. Here's an example:

   ```csharp
   using (var httpClient = new HttpClient())
   {
       var downloadUrl = "https://dev.azure.com/LumiaWoA/Boot%20Shim/_apis/build/builds/123456/artifacts?artifactName=MyArtifact&api-version=6.0&%24format=zip";
       var response = await httpClient.GetAsync(downloadUrl);
       response.EnsureSuccessStatusCode();
       using (var stream = await response.Content.ReadAsStreamAsync())
       {
           // Save the artifact to a file or do something else with it
       }
   }
   ```

   Replace `downloadUrl` with the download URL of the artifact you want to download, which you obtained in step 2. In this example, the artifact is downloaded as a ZIP file. You can modify the `downloadUrl` to download the artifact in a different format or with different parameters.

--------

## GPT3.5 Attempt \#1

To download the artifacts generated by the latest build of a public Azure DevOps project, you can use the Azure DevOps REST API. Here are the steps you can follow:

1. Get the latest build ID of the project by sending a GET request to the following URL:

   ```
   https://dev.azure.com/{organization}/{project}/_apis/build/latest/{definitionId}?api-version=6.0
   ```

   Replace `{organization}` and `{project}` with the name of your organization and project, respectively. Replace `{definitionId}` with the ID of the build definition you want to get the latest build ID for.

   This API call will return a JSON response that contains the latest build ID.

2. Get the download URL for the artifacts of the latest build by sending a GET request to the following URL:

   ```
   https://dev.azure.com/{organization}/{project}/_apis/build/builds/{buildId}/artifacts?api-version=6.0&%24format=zip
   ```

   Replace `{organization}` and `{project}` with the name of your organization and project, respectively. Replace `{buildId}` with the latest build ID obtained in step 1.

   This API call will return a download URL for the artifacts of the latest build in a ZIP format.

3. Use an `HttpClient` to download the ZIP file from the download URL obtained in step 2. Here's an example code snippet:

   ```csharp
   using (var httpClient = new HttpClient())
   {
       var response = await httpClient.GetAsync(downloadUrl);
       response.EnsureSuccessStatusCode();

       using (var stream = await response.Content.ReadAsStreamAsync())
       {
           using (var fileStream = new FileStream("artifacts.zip", FileMode.Create))
           {
               await stream.CopyToAsync(fileStream);
           }
       }
   }
   ```

   Replace `downloadUrl` with the download URL obtained in step 2. This code will download the ZIP file and save it as `artifacts.zip` in the current directory.

That's it! You should now have the latest artifacts generated by the latest build of the Azure DevOps project downloaded to your local machine.

--------

## GPT3.5 Attempt \#2

To download the artifacts generated by the latest build of a public Azure DevOps project, you can use the REST API provided by Azure DevOps. Here are the steps you can follow:

1. Get the latest build ID of the project by sending a GET request to the following URL:

   ```
   https://dev.azure.com/{organization}/{project}/_apis/build/latest/{definitionId}?api-version=6.0
   ```

   Replace `{organization}` and `{project}` with the name of your organization and project respectively. Replace `{definitionId}` with the ID of the build definition you want to download artifacts from.

   This API will return the latest build ID of the specified build definition.

2. Get the download URL of the artifacts by sending a GET request to the following URL:

   ```
   https://dev.azure.com/{organization}/{project}/_apis/build/builds/{buildId}/artifacts?api-version=6.0
   ```

   Replace `{organization}` and `{project}` with the name of your organization and project respectively. Replace `{buildId}` with the latest build ID obtained from step 1.

   This API will return a JSON response containing the download URL of the artifacts.

3. Download the artifacts by sending a GET request to the download URL obtained from step 2. The artifacts will be downloaded as a zip file.

   You can use the `HttpClient` class in C# to send HTTP requests and download the artifacts. Here's an example code snippet:

   ```csharp
   using System.Net.Http;
   using System.Threading.Tasks;

   public async Task DownloadArtifactsAsync()
   {
       var organization = "LumiaWoA";
       var project = "Boot Shim";
       var definitionId = 3;

       var httpClient = new HttpClient();
       httpClient.DefaultRequestHeaders.Accept.Clear();
       httpClient.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

       // Step 1: Get the latest build ID
       var latestBuildUrl = $"https://dev.azure.com/{organization}/{project}/_apis/build/latest/{definitionId}?api-version=6.0";
       var latestBuildResponse = await httpClient.GetAsync(latestBuildUrl);
       latestBuildResponse.EnsureSuccessStatusCode();
       var latestBuildJson = await latestBuildResponse.Content.ReadAsStringAsync();
       var latestBuildId = JObject.Parse(latestBuildJson)["id"].Value<int>();

       // Step 2: Get the download URL of the artifacts
       var artifactsUrl = $"https://dev.azure.com/{organization}/{project}/_apis/build/builds/{latestBuildId}/artifacts?api-version=6.0";
       var artifactsResponse = await httpClient.GetAsync(artifactsUrl);
       artifactsResponse.EnsureSuccessStatusCode();
       var artifactsJson = await artifactsResponse.Content.ReadAsStringAsync();
       var downloadUrl = JObject.Parse(artifactsJson)["value"][0]["resource"]["downloadUrl"].Value<string>();

       // Step 3: Download the artifacts
       var artifactsResponse = await httpClient.GetAsync(downloadUrl);
       artifactsResponse.EnsureSuccessStatusCode();
       var artifactsStream = await artifactsResponse.Content.ReadAsStreamAsync();
       using (var fileStream = new FileStream("artifacts.zip", FileMode.Create))
       {
           await artifactsStream.CopyToAsync(fileStream);
       }
   }
   ```

   This code will download the artifacts as a zip file and save it to the current directory with the name `artifacts.zip`. You can modify the code to suit your needs.

--------
